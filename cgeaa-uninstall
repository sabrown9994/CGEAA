#!/bin/bash

# CGEAA Uninstaller
# Removes the globally installed cgeaa tool and its components.

set -e

# Colors for output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${BLUE}"
cat << 'EOF'
   ______ _____ ______ ___
  / ____// ____// ____//   |   /\
 / /    / / __ / __/  / /| |  /  \
/ /___ / /_/ // /___ / ___ | / /\ \
\____/ \____//_____//_/  |_|/_/  \_\

CarGurus Enterprise Applications Automation
Uninstaller
EOF
echo -e "${NC}"

echo -e "${YELLOW}This script will remove the globally installed CGEAA tool.${NC}"
read -p "Are you sure you want to continue? (y/n) " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "Uninstall cancelled."
    exit 0
fi

echo
echo "Starting uninstallation..."

# 1. Remove the main executable
CGEAA_EXECUTABLE="/usr/local/bin/cgeaa"
if [ -f "$CGEAA_EXECUTABLE" ]; then
    echo "Removing executable: $CGEAA_EXECUTABLE"
    sudo rm "$CGEAA_EXECUTABLE"
    echo -e "${GREEN}✓ Executable removed.${NC}"
else
    echo -e "${YELLOW}Executable not found, skipping.${NC}"
fi

# 2. Remove the library directory
CGEAA_LIB_DIR="/usr/local/share/cgeaa"
if [ -d "$CGEAA_LIB_DIR" ]; then
    echo "Removing library directory: $CGEAA_LIB_DIR"
    sudo rm -rf "$CGEAA_LIB_DIR"
    echo -e "${GREEN}✓ Library directory removed.${NC}"
else
    echo -e "${YELLOW}Library directory not found, skipping.${NC}"
fi

# 3. Ask to remove global configuration
GLOBAL_CONFIG_DIR="$HOME/.cgeaa"
if [ -d "$GLOBAL_CONFIG_DIR" ]; then
    echo
    echo -e "${YELLOW}Global configuration directory found at $GLOBAL_CONFIG_DIR.${NC}"
    read -p "Do you want to remove it? This will delete your global settings. (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "Removing global configuration directory..."
        rm -rf "$GLOBAL_CONFIG_DIR"
        echo -e "${GREEN}✓ Global configuration removed.${NC}"
    else
        echo "Skipping removal of global configuration."
    fi
fi

echo
echo -e "${GREEN}CGEAA has been uninstalled successfully.${NC}"
echo "You may need to open a new terminal for the changes to take effect."
